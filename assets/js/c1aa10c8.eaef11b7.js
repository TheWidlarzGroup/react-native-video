"use strict";(self.webpackChunk_react_native_video_docs=self.webpackChunk_react_native_video_docs||[]).push([["4088"],{4374:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>c,toc:()=>a,default:()=>p,metadata:()=>i,assets:()=>l,contentTitle:()=>d});var i=JSON.parse('{"id":"component/drm","title":"DRM","description":"React Native Video DRM Integration","source":"@site/versioned_docs/version-6.x/component/drm.mdx","sourceDirName":"component","slug":"/component/drm","permalink":"/react-native-video/docs/v6/component/drm","draft":false,"unlisted":false,"tags":[],"version":"6.x","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"DRM","description":"React Native Video DRM Integration"},"sidebar":"docsSidebar","previous":{"title":"Methods","permalink":"/react-native-video/docs/v6/component/methods"},"next":{"title":"Ads","permalink":"/react-native-video/docs/v6/component/ads"}}'),r=s(4848),t=s(6151),o=s(7592);let c={sidebar_position:4,title:"DRM",description:"React Native Video DRM Integration"},d="DRM",l={},a=[{value:"DRM Example",id:"drm-example",level:2},{value:"DRM Offline",id:"drm-offline",level:2},{value:"Prerequisites:",id:"prerequisites",level:3},{value:"Providing DRM Data (Tested with HTTP/HTTPS Assets)",id:"providing-drm-data-tested-with-httphttps-assets",level:2},{value:"DRM Properties",id:"drm-properties",level:3},{value:"<code>base64Certificate</code>",id:"base64certificate",level:3},{value:"<code>certificateUrl</code>",id:"certificateurl",level:3},{value:"<code>getLicense</code>",id:"getlicense",level:3},{value:"Example:",id:"example",level:4},{value:"<code>contentId</code>",id:"contentid",level:3},{value:"<code>headers</code>",id:"headers",level:3},{value:"Example:",id:"example-1",level:4},{value:"<code>licenseServer</code>",id:"licenseserver",level:3},{value:"<code>multiDrm</code>",id:"multidrm",level:3},{value:"<code>type</code>",id:"type",level:3},{value:"<code>localSourceEncryptionKeyScheme</code>",id:"localsourceencryptionkeyscheme",level:3},{value:"Example:",id:"example-2",level:4},{value:"Common Usage Scenarios",id:"common-usage-scenarios",level:2},{value:"Sending Cookies to the License Server",id:"sending-cookies-to-the-license-server",level:3},{value:"Example:",id:"example-3",level:4},{value:"Custom License Acquisition (iOS Only)",id:"custom-license-acquisition-ios-only",level:3},{value:"Example:",id:"example-4",level:4}];function h(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"drm",children:"DRM"})}),"\n",(0,r.jsx)(n.h2,{id:"drm-example",children:"DRM Example"}),"\n",(0,r.jsxs)(n.p,{children:["We provide a sample implementation in the ",(0,r.jsx)(n.a,{href:"https://github.com/TheWidlarzGroup/react-native-video/blob/master/examples/common/DRMExample.tsx",children:"example app"})," demonstrating how to use DRM with ",(0,r.jsx)(n.code,{children:"react-native-video"}),". You\u2019ll need a valid token\u2014visit ",(0,r.jsx)(n.a,{href:"https://www.thewidlarzgroup.com/services/free-drm-token-generator-for-video?utm_source=rnv&utm_medium=docs&utm_campaign=drm&utm_id=text",children:"our site"})," to obtain a ",(0,r.jsx)(n.strong,{children:"free 24-hour token"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"drm-offline",children:"DRM Offline"}),"\n",(0,r.jsxs)(n.p,{children:["If you need DRM-protected content available offline, our ",(0,r.jsx)(n.a,{href:"https://www.thewidlarzgroup.com/offline-video-sdk/?utm_source=rnv&utm_medium=docs&utm_campaign=drm&utm_id=offline-video-sdk-link",children:"Offline Video SDK"})," enables downloading, storing, and managing streams with and without DRM. It also handles many edge cases you may encounter over time."]}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"react-native-video"})," v6 or v7. If you're still on v5 or lower, ",(0,r.jsx)(n.a,{href:"https://www.thewidlarzgroup.com/?utm_source=rnv&utm_medium=docs&utm_campaign=drm&utm_id=upgrade-contact#Contact",children:"contact us"})," for assistance."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Supporting our software kits helps maintain this open-source project. Thank you!"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"providing-drm-data-tested-with-httphttps-assets",children:"Providing DRM Data (Tested with HTTP/HTTPS Assets)"}),"\n",(0,r.jsxs)(n.p,{children:["You can configure DRM playback by providing a DRM object with the following properties. This feature disables the use of ",(0,r.jsx)(n.code,{children:"TextureView"})," on Android."]}),"\n",(0,r.jsx)(n.h3,{id:"drm-properties",children:"DRM Properties"}),"\n",(0,r.jsx)(n.h3,{id:"base64certificate",children:(0,r.jsx)(n.code,{children:"base64Certificate"})}),"\n",(0,r.jsx)(o.A,{types:["iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," boolean\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"false"})]}),"\n",(0,r.jsx)(n.p,{children:"Indicates whether the certificate URL returns data in Base64 format."}),"\n",(0,r.jsx)(n.h3,{id:"certificateurl",children:(0,r.jsx)(n.code,{children:"certificateUrl"})}),"\n",(0,r.jsx)(o.A,{types:["iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," string\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsx)(n.p,{children:"The URL used to fetch a valid certificate for FairPlay."}),"\n",(0,r.jsx)(n.h3,{id:"getlicense",children:(0,r.jsx)(n.code,{children:"getLicense"})}),"\n",(0,r.jsx)(o.A,{types:["iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," function\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsxs)(n.p,{children:["Instead of setting ",(0,r.jsx)(n.code,{children:"licenseServer"}),", you can manually acquire the license in JavaScript and send the result to the native module for FairPlay DRM configuration."]}),"\n",(0,r.jsxs)(n.p,{children:["The following parameters are available in ",(0,r.jsx)(n.code,{children:"getLicense"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"contentId"}),": The content ID from the DRM object or ",(0,r.jsx)(n.code,{children:"loadingRequest.request.url?.host"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"loadedLicenseUrl"}),": The URL retrieved from ",(0,r.jsx)(n.code,{children:"loadingRequest.request.URL.absoluteString"}),", starting with ",(0,r.jsx)(n.code,{children:"skd://"})," or ",(0,r.jsx)(n.code,{children:"clearkey://"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"licenseServer"}),": The URL passed in the DRM object"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spcString"}),": The SPC used for DRM validation"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["You should return a Base64-encoded CKC response, either directly or as a ",(0,r.jsx)(n.code,{children:"Promise"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"example",children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'getLicense: (spcString, contentId, licenseUrl, loadedLicenseUrl) => {\n  const base64spc = Base64.encode(spcString);\n  const formData = new FormData();\n  formData.append("spc", base64spc);\n  return fetch(`https://license.pallycon.com/ri/licenseManager.do`, {\n    method: "POST",\n    headers: {\n      "pallycon-customdata-v2": "your-custom-header",\n      "Content-Type": "application/x-www-form-urlencoded",\n    },\n    body: formData,\n  })\n    .then((response) => response.text())\n    .then((response) => response)\n    .catch((error) => console.error("Error", error));\n};\n'})}),"\n",(0,r.jsx)(n.h3,{id:"contentid",children:(0,r.jsx)(n.code,{children:"contentId"})}),"\n",(0,r.jsx)(o.A,{types:["iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," string\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsxs)(n.p,{children:["Sets the content ID for the stream. If not specified, the system uses the host value from ",(0,r.jsx)(n.code,{children:"loadingRequest.request.URL.host"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"headers",children:(0,r.jsx)(n.code,{children:"headers"})}),"\n",(0,r.jsx)(o.A,{types:["Android","iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," Object\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsx)(n.p,{children:"Custom headers for the license server request."}),"\n",(0,r.jsx)(n.h4,{id:"example-1",children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"drm: {\n  type: DRMType.WIDEVINE,\n  licenseServer: 'https://drm-widevine-licensing.axtest.net/AcquireLicense',\n  headers: {\n    'X-AxDRM-Message': 'your-drm-header',\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"licenseserver",children:(0,r.jsx)(n.code,{children:"licenseServer"})}),"\n",(0,r.jsx)(o.A,{types:["Android","iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," string\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsx)(n.p,{children:"The license server URL that authorizes protected content playback."}),"\n",(0,r.jsx)(n.h3,{id:"multidrm",children:(0,r.jsx)(n.code,{children:"multiDrm"})}),"\n",(0,r.jsx)(o.A,{types:["Android"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," boolean\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"false"})]}),"\n",(0,r.jsxs)(n.p,{children:["Indicates whether the DRM system should support key rotation. See ",(0,r.jsx)(n.a,{href:"https://developer.android.google.cn/media/media3/exoplayer/drm?hl=en#key-rotation",children:"Android Developer Docs"})," for more details."]}),"\n",(0,r.jsx)(n.h3,{id:"type",children:(0,r.jsx)(n.code,{children:"type"})}),"\n",(0,r.jsx)(o.A,{types:["Android","iOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," DRMType\n",(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n",(0,r.jsx)(n.p,{children:"Defines the DRM type:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Android:"})," ",(0,r.jsx)(n.code,{children:"DRMType.WIDEVINE"}),", ",(0,r.jsx)(n.code,{children:"DRMType.PLAYREADY"}),", ",(0,r.jsx)(n.code,{children:"DRMType.CLEARKEY"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"iOS:"})," ",(0,r.jsx)(n.code,{children:"DRMType.FAIRPLAY"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"localsourceencryptionkeyscheme",children:(0,r.jsx)(n.code,{children:"localSourceEncryptionKeyScheme"})}),"\n",(0,r.jsx)(o.A,{types:["iOS","visionOS"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type:"})," string"]}),"\n",(0,r.jsx)(n.p,{children:"Sets the URL scheme for stream encryption keys used in local assets."}),"\n",(0,r.jsx)(n.h4,{id:"example-2",children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'localSourceEncryptionKeyScheme = "my-offline-key";\n'})}),"\n",(0,r.jsx)(n.h2,{id:"common-usage-scenarios",children:"Common Usage Scenarios"}),"\n",(0,r.jsx)(n.h3,{id:"sending-cookies-to-the-license-server",children:"Sending Cookies to the License Server"}),"\n",(0,r.jsxs)(n.p,{children:["You can send cookies using the ",(0,r.jsx)(n.code,{children:"headers"})," prop."]}),"\n",(0,r.jsx)(n.h4,{id:"example-3",children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"drm: {\n  type: DRMType.WIDEVINE,\n  licenseServer: 'https://drm-widevine-licensing.axtest.net/AcquireLicense',\n  headers: {\n    'Cookie': 'PHPSESSID=your-session-id; csrftoken=mytoken; _gat=1; foo=bar'\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"custom-license-acquisition-ios-only",children:"Custom License Acquisition (iOS Only)"}),"\n",(0,r.jsx)(n.h4,{id:"example-4",children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"drm: {\n  type: DRMType.FAIRPLAY,\n  getLicense: (spcString) => {\n    const base64spc = Base64.encode(spcString);\n    return fetch('YOUR_LICENSE_SERVER_URL', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n      },\n      body: JSON.stringify({\n        getFairplayLicense: {\n          foo: 'bar',\n          spcMessage: base64spc,\n        }\n      })\n    })\n      .then(response => response.json())\n      .then((response) => {\n        if (response?.getFairplayLicenseResponse?.ckcResponse) {\n          return response.getFairplayLicenseResponse.ckcResponse;\n        }\n        throw new Error('No valid response');\n      })\n      .catch((error) => console.error('CKC error', error));\n  }\n}\n"})})]})}function p(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},7592:function(e,n,s){s.d(n,{A:()=>r});var i=s(4848);s(6540);let r=function({types:e}){return(0,i.jsxs)("p",{className:"paragraphStyle_TW2u",children:[1!==e.length||e.includes("All")?"Platforms:":"Platform:",(0,i.jsx)("span",{className:"spanStyle_JqKD",children:" "+e.join(" | ")})]})}},6151:function(e,n,s){s.d(n,{R:()=>o,x:()=>c});var i=s(6540);let r={},t=i.createContext(r);function o(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);