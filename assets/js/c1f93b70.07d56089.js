"use strict";(self.webpackChunk_react_native_video_docs=self.webpackChunk_react_native_video_docs||[]).push([["547"],{1553:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>l,toc:()=>c,default:()=>h,metadata:()=>i,assets:()=>d,contentTitle:()=>s});var i=JSON.parse('{"id":"player/analytics/manual","title":"Manual Analytics","description":"Manual analytics integration guide using native plugins","source":"@site/docs/player/analytics/manual.md","sourceDirName":"player/analytics","slug":"/player/analytics/manual","permalink":"/react-native-video/docs/v7/player/analytics/manual","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Manual (Native)","description":"Manual analytics integration guide using native plugins"},"sidebar":"docsSidebar","previous":{"title":"Simple (JS Events)","permalink":"/react-native-video/docs/v7/player/analytics/simple"},"next":{"title":"Introduction","permalink":"/react-native-video/docs/v7/video-view/"}}'),t=r(4848),a=r(6151);let l={sidebar_position:2,sidebar_label:"Manual (Native)",description:"Manual analytics integration guide using native plugins"},s="Manual Analytics",d={},c=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Android (Kotlin)",id:"android-kotlin",level:3},{value:"iOS (Swift)",id:"ios-swift",level:3},{value:"Available Metrics",id:"available-metrics",level:2},{value:"Android (ExoPlayer AnalyticsListener)",id:"android-exoplayer-analyticslistener",level:3},{value:"iOS (AVPlayer)",id:"ios-avplayer",level:3},{value:"Registration",id:"registration",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"manual-analytics",children:"Manual Analytics"})}),"\n",(0,t.jsx)(n.p,{children:"Integrate your own analytics system using native plugins."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["Most analytics systems that track player data (e.g., bitrate, errors) can be integrated directly with ExoPlayer or AVPlayer. The ",(0,t.jsx)(n.a,{href:"/react-native-video/docs/v7/plugins/",children:"plugin system"})," allows for non-intrusive analytics integration with react-native-video. It should be implemented in native languages (Kotlin/Swift) to ensure efficiency."]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     React Native App                \u2502\n\u2502  \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502   react-native-video          \u2502  \u2502\n\u2502  \u2502  \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   Plugin System         \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                    \u2502\n         \u2502 onPlayerCreated    \u2502 onPlayerCreated\n         \u25BC                    \u25BC\n\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Android Plugin  \u2502  \u2502  iOS Plugin     \u2502\n\u2502   (Kotlin)      \u2502  \u2502   (Swift)       \u2502\n\u2502                 \u2502  \u2502                 \u2502\n\u2502 ExoPlayer       \u2502  \u2502 AVPlayer        \u2502\n\u2502 Analytics       \u2502  \u2502 KVO Observers   \u2502\n\u2502 Listener        \u2502  \u2502                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"android-kotlin",children:"Android (Kotlin)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:'import androidx.annotation.OptIn\nimport androidx.media3.common.Format\nimport androidx.media3.common.PlaybackException\nimport androidx.media3.common.Player\nimport androidx.media3.common.util.UnstableApi\nimport androidx.media3.exoplayer.analytics.AnalyticsListener\nimport com.twg.video.core.plugins.NativeVideoPlayer\nimport com.twg.video.core.plugins.ReactNativeVideoPlugin\nimport java.lang.ref.WeakReference\n\n@OptIn(UnstableApi::class)\nclass AnalyticsPlugin : ReactNativeVideoPlugin("MyAnalytics") {\n    \n    override fun onPlayerCreated(player: WeakReference<NativeVideoPlayer>) {\n        val nativePlayer = player.get() ?: return\n        val exoPlayer = nativePlayer.player\n        \n        exoPlayer.addAnalyticsListener(object : AnalyticsListener {\n            override fun onBandwidthEstimate(\n                eventTime: AnalyticsListener.EventTime,\n                totalLoadTimeMs: Int,\n                totalBytesLoaded: Long,\n                bitrateEstimate: Long\n            ) {\n                trackMetric("bitrate", bitrateEstimate)\n            }\n            \n            override fun onDroppedVideoFrames(\n                eventTime: AnalyticsListener.EventTime,\n                droppedFrames: Int,\n                elapsedMs: Long\n            ) {\n                trackMetric("dropped_frames", droppedFrames)\n            }\n            \n            override fun onVideoInputFormatChanged(\n                eventTime: AnalyticsListener.EventTime,\n                format: Format,\n                decoderReuseDecision: Int?\n            ) {\n                trackEvent("quality_change", mapOf(\n                    "width" to format.width,\n                    "height" to format.height,\n                    "bitrate" to format.bitrate\n                ))\n            }\n            \n            override fun onPlaybackStateChanged(\n                eventTime: AnalyticsListener.EventTime,\n                state: Int\n            ) {\n                when (state) {\n                    Player.STATE_BUFFERING -> trackEvent("buffering_start")\n                    Player.STATE_READY -> trackEvent("buffering_end")\n                    Player.STATE_ENDED -> trackEvent("playback_complete")\n                }\n            }\n            \n            override fun onPlayerError(\n                eventTime: AnalyticsListener.EventTime,\n                error: PlaybackException\n            ) {\n                trackEvent("error", mapOf(\n                    "code" to error.errorCode,\n                    "message" to error.message\n                ))\n            }\n        })\n    }\n    \n    override fun onPlayerDestroyed(player: WeakReference<NativeVideoPlayer>) {\n        flushAnalytics()\n    }\n    \n    private fun trackEvent(name: String, params: Map<String, Any?> = emptyMap()) {\n        // Send to your analytics backend\n    }\n    \n    private fun trackMetric(name: String, value: Number) {\n        // Send to your analytics backend\n    }\n    \n    private fun flushAnalytics() {\n        // Flush pending analytics\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"ios-swift",children:"iOS (Swift)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-swift",children:'import AVFoundation\n\nclass AnalyticsPlugin: ReactNativeVideoPlugin {\n    \n    // MARK: - Properties\n    \n    private weak var currentPlayer: AVPlayer?\n    private var rateObserver: NSKeyValueObservation?\n    private var statusObserver: NSKeyValueObservation?\n    private var timeObserver: Any?\n    \n    // MARK: - Init\n    \n    init() {\n        super.init(name: "MyAnalytics")\n    }\n    \n    // MARK: - Plugin Lifecycle\n    \n    override func onPlayerCreated(player: Weak<NativeVideoPlayer>) {\n        guard let nativePlayer = player.value else { return }\n        currentPlayer = nativePlayer.player\n        \n        setupPlaybackObservers(for: nativePlayer.player)\n        setupQualityTracking(for: nativePlayer.playerItem)\n    }\n    \n    override func onPlayerDestroyed(player: Weak<NativeVideoPlayer>) {\n        removeAllObservers()\n        flushAnalytics()\n    }\n    \n    // MARK: - Setup\n    \n    private func setupPlaybackObservers(for player: AVPlayer) {\n        rateObserver = player.observe(\\.rate) { [weak self] p, _ in\n            self?.trackEvent(p.rate > 0 ? "play" : "pause")\n        }\n        \n        statusObserver = player.observe(\\.status) { [weak self] p, _ in\n            if p.status == .readyToPlay {\n                self?.trackEvent("ready")\n            } else if p.status == .failed {\n                self?.trackEvent("error", params: ["message": p.error?.localizedDescription ?? ""])\n            }\n        }\n        \n        timeObserver = player.addPeriodicTimeObserver(\n            forInterval: CMTime(seconds: 10, preferredTimescale: 1),\n            queue: .main\n        ) { [weak self] time in\n            self?.trackMetric("position", value: time.seconds)\n        }\n    }\n    \n    private func setupQualityTracking(for playerItem: AVPlayerItem?) {\n        NotificationCenter.default.addObserver(\n            self,\n            selector: #selector(handleAccessLog),\n            name: .AVPlayerItemNewAccessLogEntry,\n            object: playerItem\n        )\n    }\n    \n    @objc private func handleAccessLog(_ notification: Notification) {\n        guard let item = notification.object as? AVPlayerItem,\n              let event = item.accessLog()?.events.last else { return }\n        \n        trackMetric("bitrate", value: event.indicatedBitrate)\n        trackMetric("stalls", value: Double(event.numberOfStalls))\n        trackMetric("dropped_frames", value: Double(event.numberOfDroppedVideoFrames))\n    }\n    \n    private func removeAllObservers() {\n        if let observer = timeObserver {\n            currentPlayer?.removeTimeObserver(observer)\n        }\n        rateObserver?.invalidate()\n        statusObserver?.invalidate()\n        NotificationCenter.default.removeObserver(self)\n        \n        currentPlayer = nil\n        timeObserver = nil\n    }\n    \n    // MARK: - Analytics\n    \n    private func trackEvent(_ name: String, params: [String: Any] = [:]) {\n        // Send to your analytics backend\n    }\n    \n    private func trackMetric(_ name: String, value: Double) {\n        // Send to your analytics backend\n    }\n    \n    private func flushAnalytics() {\n        // Flush pending analytics\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"available-metrics",children:"Available Metrics"}),"\n",(0,t.jsx)(n.h3,{id:"android-exoplayer-analyticslistener",children:"Android (ExoPlayer AnalyticsListener)"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Event"}),(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Data"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Bitrate"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"onBandwidthEstimate"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bitrateEstimate"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Dropped frames"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"onDroppedVideoFrames"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"droppedFrames"}),", ",(0,t.jsx)(n.code,{children:"elapsedMs"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Quality change"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"onVideoInputFormatChanged"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"format.width"}),", ",(0,t.jsx)(n.code,{children:"format.height"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Buffering"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"onPlaybackStateChanged"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Player.STATE_BUFFERING"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Stall"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"onStallStart"})," / ",(0,t.jsx)(n.code,{children:"onStallEnd"})]}),(0,t.jsx)(n.td,{children:"duration"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Seek"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"onSeekStarted"})," / ",(0,t.jsx)(n.code,{children:"onSeekProcessed"})]}),(0,t.jsx)(n.td,{children:"position"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Error"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"onPlayerError"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"errorCode"}),", ",(0,t.jsx)(n.code,{children:"message"})]})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"ios-avplayer",children:"iOS (AVPlayer)"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Source"}),(0,t.jsx)(n.th,{children:"Property"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Bitrate"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"accessLog"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"indicatedBitrate"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Stalls"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"accessLog"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"numberOfStalls"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Dropped frames"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"accessLog"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"numberOfDroppedVideoFrames"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Bytes"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"accessLog"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"numberOfBytesTransferred"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Playback status"}),(0,t.jsx)(n.td,{children:"KVO"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"player.status"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Play/Pause"}),(0,t.jsx)(n.td,{children:"KVO"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"player.rate"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Buffer"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"playerItem"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"isPlaybackLikelyToKeepUp"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"registration",children:"Registration"}),"\n",(0,t.jsx)(n.p,{children:"Plugins auto-register when instantiated. Create your plugin early in app lifecycle:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Android"})," - ",(0,t.jsx)(n.code,{children:"MainApplication.kt"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:"class MainApplication : Application() {\n    override fun onCreate() {\n        super.onCreate()\n        AnalyticsPlugin() // Auto-registers via init block\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"iOS"})," - ",(0,t.jsx)(n.code,{children:"AppDelegate.swift"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-swift",children:"@main\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n    private var analyticsPlugin: AnalyticsPlugin?\n    \n    func application(\n        _ application: UIApplication,\n        didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?\n    ) -> Bool {\n        analyticsPlugin = AnalyticsPlugin() // Auto-registers via init\n        return true\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/react-native-video/docs/v7/plugins/",children:"Plugins"})," - Full plugin system documentation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/react-native-video/docs/v7/plugins/interface",children:"Plugin Interface"})," - Complete API reference"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},6151:function(e,n,r){r.d(n,{R:()=>l,x:()=>s});var i=r(6540);let t={},a=i.createContext(t);function l(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);