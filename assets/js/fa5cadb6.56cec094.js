"use strict";(self.webpackChunk_react_native_video_docs=self.webpackChunk_react_native_video_docs||[]).push([["8116"],{5687:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>l,toc:()=>a,default:()=>h,metadata:()=>r,assets:()=>c,contentTitle:()=>t});var r=JSON.parse('{"id":"player/downloading/drm-downloading","title":"DRM Downloading","description":"Downloading and playing DRM-protected content offline","source":"@site/docs/player/downloading/drm-downloading.md","sourceDirName":"player/downloading","slug":"/player/downloading/drm-downloading","permalink":"/react-native-video/docs/v7/player/downloading/drm-downloading","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"DRM Downloading","description":"Downloading and playing DRM-protected content offline"},"sidebar":"docsSidebar","previous":{"title":"Track Selection","permalink":"/react-native-video/docs/v7/player/downloading/track-selection"},"next":{"title":"Simple (JS Events)","permalink":"/react-native-video/docs/v7/player/analytics/simple"}}'),s=i(4848),o=i(6151);let l={sidebar_position:5,sidebar_label:"DRM Downloading",description:"Downloading and playing DRM-protected content offline"},t="DRM Downloading",c={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"High-level Flow",id:"high-level-flow",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Basic DRM Configuration",id:"basic-drm-configuration",level:3},{value:"FairPlay (iOS)",id:"fairplay-ios",level:3},{value:"Custom License Acquisition (iOS only)",id:"custom-license-acquisition-ios-only",level:3},{value:"Platform-Specific Notes",id:"platform-specific-notes",level:2},{value:"Android",id:"android",level:3},{value:"iOS",id:"ios",level:3},{value:"Testing",id:"testing",level:2},{value:"FairPlay Notes",id:"fairplay-notes",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"drm-downloading",children:"DRM Downloading"})}),"\n",(0,s.jsx)(n.p,{children:"The Offline Video SDK supports downloading and playing DRM-protected content offline, including support for persistent licenses."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.admonition,{title:"Critical Requirement",type:"warning",children:(0,s.jsxs)(n.p,{children:["Your DRM provider ",(0,s.jsx)(n.strong,{children:"must support persistent/offline licenses"}),". Not all DRM providers support this feature. Contact your DRM provider to confirm offline license support before implementing."]})}),"\n",(0,s.jsx)(n.p,{children:"To download DRM-protected content, you need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Encrypted media"}),": Video content encrypted with DRM (Widevine, FairPlay, PlayReady)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"License server"}),": A license server that supports ",(0,s.jsx)(n.strong,{children:"persistent/offline licenses"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Short-lived token"}),": Authentication token for license acquisition (if required)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"high-level-flow",children:"High-level Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Content Preparation"}),": Media is encrypted and packaged with DRM"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"License Server Configuration"}),": License server is configured to issue persistent licenses"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Download with DRM Config"}),": Call ",(0,s.jsx)(n.code,{children:"downloadStream"})," with DRM configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"License Acquisition"}),": SDK automatically acquires and stores persistent license"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Offline Playback"}),": Downloaded content can be played offline using the stored license"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"drm"})," property in ",(0,s.jsx)(n.code,{children:"downloadStream"})," accepts a ",(0,s.jsx)(n.code,{children:"DRMConfig"})," with the following properties:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"licenseServer: string"})," - URL of the license server"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"certificateUrl?: string"})," - Certificate URL (required for FairPlay on iOS)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"headers?: Record<string, string>"})," - HTTP headers for license requests"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"getLicense?: (spcData: ArrayBuffer) => Promise<ArrayBuffer>"})," - Custom license acquisition function (iOS only, FairPlay)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/react-native-video/docs/v7/player/downloading/#drmconfig",children:"DRMConfig"})," in API Reference for complete type definition."]}),"\n",(0,s.jsx)(n.h3,{id:"basic-drm-configuration",children:"Basic DRM Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'import { downloadStream } from "@TheWidlarzGroup/react-native-video-stream-downloader";\n\nawait downloadStream(videoUrl, {\n  drm: {\n    licenseServer: "https://license.example.com/acquire",\n    headers: {\n      "Authorization": "Bearer YOUR_TOKEN",\n    },\n  },\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"fairplay-ios",children:"FairPlay (iOS)"}),"\n",(0,s.jsx)(n.p,{children:"For FairPlay on iOS, you also need to provide the certificate URL:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'await downloadStream(videoUrl, {\n  drm: {\n    licenseServer: "https://license.example.com/acquire",\n    certificateUrl: "https://license.example.com/certificate.cer",\n    headers: {\n      "Authorization": "Bearer YOUR_TOKEN",\n    },\n  },\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"custom-license-acquisition-ios-only",children:"Custom License Acquisition (iOS only)"}),"\n",(0,s.jsx)(n.p,{children:"On iOS, you can provide a custom license acquisition function:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'await downloadStream(videoUrl, {\n  drm: {\n    licenseServer: "https://license.example.com/acquire",\n    certificateUrl: "https://license.example.com/certificate.cer",\n    getLicense: async (spcData: ArrayBuffer) => {\n      // Custom license acquisition logic\n      const response = await fetch("https://license.example.com/acquire", {\n        method: "POST",\n        headers: {\n          "Content-Type": "application/octet-stream",\n          "Authorization": "Bearer YOUR_TOKEN",\n        },\n        body: spcData,\n      });\n      return await response.arrayBuffer();\n    },\n  },\n});\n'})}),"\n",(0,s.jsx)(n.h2,{id:"platform-specific-notes",children:"Platform-Specific Notes"}),"\n",(0,s.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Supports Widevine and PlayReady"}),"\n",(0,s.jsx)(n.li,{children:"License acquisition is handled automatically by the SDK"}),"\n",(0,s.jsx)(n.li,{children:"Ensure your license server supports persistent licenses"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Supports FairPlay"}),"\n",(0,s.jsxs)(n.li,{children:["Requires ",(0,s.jsx)(n.code,{children:"certificateUrl"})," for FairPlay"]}),"\n",(0,s.jsxs)(n.li,{children:["Custom license acquisition via ",(0,s.jsx)(n.code,{children:"getLicense"})," is optional but available"]}),"\n",(0,s.jsxs)(n.li,{children:["FairPlay configuration should match your ",(0,s.jsx)(n.code,{children:"react-native-video"})," DRM setup"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Always test DRM downloading on a ",(0,s.jsx)(n.strong,{children:"real device"}),". Simulators/emulators may not properly handle DRM operations."]})}),"\n",(0,s.jsx)(n.p,{children:"When testing:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure your test content is properly encrypted"}),"\n",(0,s.jsx)(n.li,{children:"Verify your license server supports persistent licenses"}),"\n",(0,s.jsx)(n.li,{children:"Test on both iOS and Android devices"}),"\n",(0,s.jsx)(n.li,{children:"Verify offline playback works after download completes"}),"\n",(0,s.jsx)(n.li,{children:"Test license expiration scenarios"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"fairplay-notes",children:"FairPlay Notes"}),"\n",(0,s.jsxs)(n.p,{children:["The FairPlay configuration for offline downloading should match your ",(0,s.jsx)(n.code,{children:"react-native-video"})," DRM configuration exactly. Use the same:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"licenseServer"})," URL"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"certificateUrl"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"headers"})," (if applicable)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"getLicense"})," function (if using custom acquisition)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This ensures consistency between online and offline playback."})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},6151:function(e,n,i){i.d(n,{R:()=>l,x:()=>t});var r=i(6540);let s={},o=r.createContext(s);function l(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);